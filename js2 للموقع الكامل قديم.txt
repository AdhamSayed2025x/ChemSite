/* ============ 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ ============ */
// Ø§Ù„Ù…ØªØºÙŠØ± Ø¯Ù‡ Ø¨ÙŠØ¹Ø±ÙÙ†Ø§ Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù† ÙˆÙ„Ø§ Ù„Ø£ Ù…Ù† Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­
let isAdmin = localStorage.getItem('isAdmin') === 'true';

// Ø£ÙˆÙ„ Ù…Ø§ Ø§Ù„ØµÙØ­Ø© ØªÙØªØ­ØŒ Ù†Ø­Ø¯Ø« Ø§Ù„Ø´ÙƒÙ„
window.onload = function() {
    updateUI();
};

function updateUI() {
    const headerActions = document.querySelector('.header-actions');
    const loginBtn = document.querySelector('.login-btn');

    // Ø´Ø±Ø· Ø£Ø³Ø§Ø³ÙŠ: Ù„Ø§Ø²Ù… Ù†ÙƒÙˆÙ† Ø£Ø¯Ù…Ù† ÙˆØ§Ù„ØµÙØ­Ø© ÙÙŠÙ‡Ø§ Ù‡ÙŠØ¯Ø±
    if (isAdmin && headerActions) {

        // 1. ØªÙ†Ø¸ÙŠÙ: Ù„Ùˆ ÙÙŠÙ‡ Ø²Ø±Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø´ÙŠÙ„Ù‡ (Ø¹Ø´Ø§Ù† Ø§Ø­Ù†Ø§ Ø£Ø¯Ù…Ù† Ø®Ù„Ø§Øµ)
        if (loginBtn) loginBtn.remove();

        // 2. Ø§Ù„Ø³Ø­Ø±: Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ğŸ•µï¸â€â™‚ï¸
        let profileImg = document.querySelector('.profile-img-btn');

        // Ù†Ø¬ÙŠØ¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const savedImg = localStorage.getItem('profilePic') || "https://img.freepik.com/free-photo/portrait-white-man-isolated_53876-40306.jpg";

        if (!profileImg) {
            // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ØµÙˆØ±Ø© Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø© -> ÙŠØ¨Ù‚Ù‰ Ù†Ø¶ÙŠÙÙ‡Ø§ Ø¥Ø­Ù†Ø§
            const imgHTML = `
                <img src="${savedImg}" 
                     class="profile-img-btn" 
                     onclick="window.location.href='profile.html'"
                     title="Admin Profile"
                     style="width:45px; height:45px; border-radius:50%; border:2px solid var(--primary-color); cursor:pointer;">
            `;
            headerActions.insertAdjacentHTML('beforeend', imgHTML);
        } else {
            // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ù„ØµÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø²ÙŠ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†) -> Ù†Ø­Ø¯Ø«Ù‡Ø§ ÙˆÙ†ØµÙ„Ø­ Ø§Ù„Ø²Ø±Ø§Ø±
            profileImg.src = savedImg; // Ù†Ø­Ø¯Ø« Ø§Ù„Ø´ÙƒÙ„
            profileImg.onclick = function() { window.location.href = 'profile.html'; }; // Ù†ØµÙ„Ø­ Ø§Ù„Ù„ÙŠÙ†Ùƒ
            profileImg.style.cursor = "pointer"; // Ù†ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù…Ø§ÙˆØ³ Ø¨ÙŠØªØ­ÙˆÙ„ Ù„ÙŠØ¯
        }
    }
}

/* ============ 2. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ (Ø§Ù„Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹) ============ */
function showComingSoon(featureName) {
    // Ù„Ùˆ Ø±Ø§ÙŠØ­ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    if (featureName === 'Login Page') {
        window.location.href = 'login.html';
        return;
    }

    // Ù‡Ù†Ø§ Ø§Ù„Ø³Ø­Ø±: Ù„Ùˆ Ø£Ø¯Ù…Ù† ÙˆØ¯ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©ØŒ Ù„Ùˆ Ø·Ø§Ù„Ø¨ ÙˆØ¯ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
    if (isAdmin) {
        window.location.href = `admin_page.html?page=${featureName}`;
    } else {
        window.location.href = `soon.html?page=${featureName}`;
    }
}

/* ============ 3. Ù…Ù†Ø·Ù‚ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ============ */
function togglePassword() {
    const passInput = document.getElementById('passInput');
    const icon = document.getElementById('togglePass');
    if (passInput.type === 'password') {
        passInput.type = 'text';
        icon.classList.remove('fa-lock');
        icon.classList.add('fa-lock-open');
    } else {
        passInput.type = 'password';
        icon.classList.remove('fa-lock-open');
        icon.classList.add('fa-lock');
    }
}

function clearError(errorId) {
    document.getElementById(errorId).classList.remove('visible');
}

function performLogin() {
    const email = document.getElementById('emailInput').value;
    const pass = document.getElementById('passInput').value;
    const emailError = document.getElementById('emailError');
    const passError = document.getElementById('passError');

    // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Adham / 123)
    let isValid = true;

    if (email !== "Adham" && email !== "Adham@Vision.Bim") {
        emailError.innerText = "Wrong Username";
        emailError.classList.add('visible');
        isValid = false;
    }
    if (pass !== "123") {
        passError.innerText = "Wrong Password";
        passError.classList.add('visible');
        isValid = false;
    }

    if (isValid) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡
        document.getElementById('successOverlay').classList.add('active');
        // Ø­ÙØ¸ Ø¥Ù†Ùƒ Ø¨Ù‚ÙŠØª Ø£Ø¯Ù…Ù†
        localStorage.setItem('isAdmin', 'true');
        // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
        setTimeout(() => {
            window.location.href = "index.html";
        }, 2000);
    }
}

/* ============ 4. Ù…Ù†Ø·Ù‚ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª) ============ */
function toggleFab() {
    const menu = document.getElementById('fabMenu');
    const btn = document.querySelector('.fab-main-btn');
    if(menu) menu.classList.toggle('show');
    if(btn) btn.classList.toggle('active');
}

function openUploadModal() {
    document.getElementById('uploadModal').classList.add('active');
    toggleFab(); // Ù†Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
}

function closeModal() {
    document.getElementById('uploadModal').classList.remove('active');
}

function publishContent() {
    const title = document.getElementById('contentTitle').value;
    const desc = document.getElementById('contentDesc').value;
    const type = document.getElementById('contentType').value;

    if(title.trim() === "") {
        alert("Please enter a title!");
        return;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØ§Ø±Øª Ù„Ù„ØµÙØ­Ø©
    let gridContainer = document.querySelector('.items-grid');
    const emptyMsg = document.getElementById('emptyMsg');
    
    if(emptyMsg) emptyMsg.style.display = 'none';

    let iconClass = 'fa-file-pdf';
    if(type === 'video') iconClass = 'fa-video';
    if(type === 'link') iconClass = 'fa-link';

    const cardHtml = `
        <div class="content-card">
            <div class="card-icon"><i class="fa-solid ${iconClass}"></i></div>
            <h3 class="card-title">${title}</h3>
            <p class="card-desc">${desc}</p>
            <div class="card-actions">
                <button class="action-btn btn-delete" onclick="this.closest('.content-card').remove()"><i class="fa-solid fa-trash"></i></button>
                <a href="#" class="action-btn btn-view">View Content</a>
            </div>
        </div>
    `;

    if(gridContainer) gridContainer.insertAdjacentHTML('afterbegin', cardHtml);

    // ØªÙ†Ø¸ÙŠÙ
    document.getElementById('contentTitle').value = "";
    document.getElementById('contentDesc').value = "";
    closeModal();
}

/* ============ 5. Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© (Ø¨Ø­Ø« ÙˆÙÙˆØªØ±) ============ */
function toggleSearch() {
    const searchContainer = document.querySelector('.search-container');
    const searchInput = document.getElementById('searchInput');
    if(searchContainer) {
        searchContainer.classList.toggle('active');
        if (searchContainer.classList.contains('active')) searchInput.focus();
    }
}

function togglePopup(popupId) {
    document.querySelectorAll('.contact-popup').forEach(p => p.classList.remove('show'));
    const popup = document.getElementById(popupId);
    if(popup) popup.classList.toggle('show');
}

window.onclick = function(event) {
    if (!event.target.closest('.contact-item')) {
        document.querySelectorAll('.contact-popup').forEach(p => p.classList.remove('show'));
    }
}



/* ============ Ø¥Ø¶Ø§ÙØ§Øª ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (Ø¶Ø¹ Ù‡Ø°Ø§ ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ù) ============ */

// 1. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
function triggerCamera() {
    const fileInput = document.getElementById('fileUpload');
    if(fileInput) fileInput.click();
}

// 2. Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
function saveProfileImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // 1. Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙˆØ±Ø§Ù‹
            const imgElem = document.getElementById('profileImage');
            if(imgElem) imgElem.src = e.target.result;
            
            // 2. Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
            localStorage.setItem('profilePic', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
}

// 3. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù†Ø¨Ø°Ø©)
function editField(elementId, labelName) {
    const element = document.getElementById(elementId);
    if(element) {
        const currentVal = element.innerText;
        const newVal = prompt(`Enter new ${labelName}:`, currentVal);
        
        if (newVal && newVal.trim() !== "") {
            element.innerText = newVal;
            // Ø­ÙØ¸ Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³Ù… Ø§Ù„Ù€ ID Ø¨ØªØ§Ø¹Ù‡
            localStorage.setItem(elementId, newVal);
        }
    }
}

// 4. Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ø¨ÙŠØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ)
function loadProfileData() {
    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØµÙˆØ±Ø©
    const savedImg = localStorage.getItem('profilePic');
    const imgElem = document.getElementById('profileImage');
    if (savedImg && imgElem) imgElem.src = savedImg;

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø³Ù…
    const savedName = localStorage.getItem('profileNameDisplay');
    const nameElem = document.getElementById('profileNameDisplay');
    if (savedName && nameElem) nameElem.innerText = savedName;

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙˆØµÙ
    const savedAbout = localStorage.getItem('profileAboutDisplay');
    const aboutElem = document.getElementById('profileAboutDisplay');
    if (savedAbout && aboutElem) aboutElem.innerText = savedAbout;
}

// ÙƒÙˆØ¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø§ Ù†ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
if(window.location.href.includes('profile.html')) {
    window.onload = loadProfileData;
}

// 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ (Logout)
function logoutUser() {
    if(confirm("Are you sure you want to log out?")) {
        localStorage.removeItem('isAdmin');
        window.location.href = "index.html";
    }
}